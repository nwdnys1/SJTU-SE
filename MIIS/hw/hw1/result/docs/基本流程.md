# 实现流程

## 使用 OCR 识别发票并进行发票审批

- 讯飞提供的 OCR 通用接口
- 流程：
  1. 上传图片到接口进行多次识别 返回识别结果 根据识别结果进行下一步操作
  2. 如果多次识别结果不一致 比如发票类型不一致、一次是错误码但是下一次是正确的等 则放入人工审批类
  3. 如果识别结果一致 则进行下一步操作
  4. 如果为错误码 比如 10909 则放入人工审批类
  5. 如果类型不是发票 放入
  6. 如果识别结果为发票 进行模糊匹配
  7. 匹配条件：
  - 付款方为“浙江大学”：可以用模糊匹配 包含浙江大学其中 3 个字即可
  - 时间在 2015 年内：直接精准匹配就可以
  - 审批金额在 1600 元内：直接精准匹配就可以
  - 上述条件的具体字段如果是空字符串 考虑放入人工审批（因为相当于没有识别出来）
  8. 选出所有是发票的数据 进行数据处理
  - 提取出买房和卖方、金额、交易频度
  - 统计每一个交易主体的总交易额 以此分类为大客户、中客户、小客户

## 数据持久化

- 将原始数据以及审批结果存入数据库 考虑将原始数据存入文档型数据库中 处理结果存入关系型数据库中
- 数据结果应该包含
  - 审批状态：通过、未通过、人工审批
  - 交易主体的分类：大客户、中客户、小客户
- 数据结果格式
  - 发票数据
    - ID
    - 发票图片路径
    - 卖方
    - 买方
    - 金额
    - 交易时间
    - 审批状态
  - 买方表
    - ID
    - 买方
    - 交易总额
    - 交易频度
    - 客户分类
  - 卖方表
    - ID
    - 卖方
    - 交易总额
    - 交易频度
    - 客户分类
  - 交易频度表
    - ID
    - 买方
    - 卖方
    - 交易频度

## 数据计算

- 发票数量
- 审批状态比例
- 交易量最大的 k 个客户
- 其他 比如交易量最大的 k 个客户的交易量占总交易量的比例等

## 展示数据

- 使用 tagui 将数据制成 excel 报表 并发送邮件给相关人员